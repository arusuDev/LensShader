# LensShader
## ステンシルバッファを利用した描画制御を行うシェーダーのサンプルプログラムです。
### 内容物
- LensShader.shader  
これを通してみるオブジェクト（レンズ）のマテリアルに利用します。
- LensObjectShader.shader  
これをレンズを通してみたときに描画がかわるオブジェクトに利用します。  
- LensSample.unitypackage  
サンプルシーンになります。（shader二種も含まれます。)  

### 原理
シーンを描画するときに、各ピクセルにはステンシルバッファと呼ばれる制御用の変数があるみたいです。そこに、値を書き込むことによって、同一shaderでも描画結果・手法の異なる方法を取ることが出来ます。（ただし、GPUはSIMDのため、同一の命令を同時に実行しようとするからたくさん分岐させるとそれだけ待ち時間が発生するので、分岐させすぎると重くなるかも？)

### 実際の流れ
`LensObjectShader`は、描画対象になったときにステンシルバッファに1を書き込みます。
```GLSL
Stencil
    {
        Ref 1
        Comp Always
        Pass Replace
    }
```
これによって変更されたステンシルバッファを`LensShader`側が読み取り、描画方法を分岐します。Passと呼ばれる描画方法のまとまりの中で、一番初めに次のコードで判断して違ったら待つ、という感じみたい？です。  
```GLSL
Stencil
    {
        Ref 0
        Comp Equal
    }
```
感覚的にif文での分岐と一緒かなって思います。サンプルシーンでは、レンズ->オブジェクト->ターゲットという順番でオブジェクトを配置していますが、描画対象物のShaderでステンシルバッファの値を変えたら、(0のときと同じ色で描画？)それっぽくもしかしたらなるかも？って思ったので良かったらやってみると良いかもです。水玉にはなら無さそうですけど…。

## 参考文献
- [【Unityシェーダ入門】ステンシルバッファを使って隠れた部分を描く](http://nn-hokuson.hatenablog.com/entry/2017/05/02/185320)  
- [ShaderLab: ステンシル](https://docs.unity3d.com/ja/current/Manual/SL-Stencil.html)